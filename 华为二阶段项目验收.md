# 增量数据集运行命令
## 建议使用的验收方式
```
1、 放置two_stage_datasts数据集

unbiased_teacher/
└── datasets/
    └─two_stage_datasets/


2、全监督、半监督训练
/bin/sh scripts/index3.sh(举例为index3)
全监督结果保存在output/index3/baseline/soda_sup100/record/log.txt(举例为index3)
```

# 伪标签产生运行命令
## 建议使用的验收方式
```
1、 index1
1.1 进入跑完的工程并检查数据集软链接
unbiased_teacher/
└── datasets/
    └──VOC2007/
    └──VOC2012/
    └── COCO2017/
        ├── train2017/
        ├── val2017/
        └── annotations/
        	├── instances_train2017.json
        	└── instances_val2017.json

1.2 移动新文件
将新下载下来工程目录中tools/index1/make_dataset_voc2007train_voc2012trainval.py拷贝到原工程目录tools/index1/下
将新下载下来工程目录中configs/index1/index1_pseudo.yaml拷贝到原工程目录configs/index1/下
将新下载下来工程目录中tools/process_pseudo_label.py拷贝到原工程目录tools/下
将新下载下来工程目录中scripts/index1_pseudo.sh拷贝到原工程目录scripts/下

1.3 运行命令
/bin/sh scripts/index1_pseudo.sh

2、 index2
2.1 进入跑完的工程并检查数据集软链接
unbiased_teacher/
└── datasets/
    └─two_stage_datasets/
    
2.2 移动新文件
将新下载下来工程目录中configs/index2/index2_pseudo.yaml拷贝到原工程目录configs/index2/下
将新下载下来工程目录中tools/process_pseudo_label.py拷贝到原工程目录tools/下
将新下载下来工程目录中scripts/index2_pseudo.sh拷贝到原工程目录scripts/下

2.3 运行命令
/bin/sh scripts/index2_pseudo.sh

3、 index3
3.1 进入跑完的工程并检查数据集软链接
unbiased_teacher/
└── datasets/
    └─two_stage_datasets/
    
3.2 移动新文件
将新下载下来工程目录中configs/index3/index3_pseudo.yaml拷贝到原工程目录configs/index3/下
将新下载下来工程目录中tools/process_pseudo_label.py拷贝到原工程目录tools/下
将新下载下来工程目录中scripts/index3_pseudo.sh拷贝到原工程目录scripts/下

3.3 运行命令
/bin/sh scripts/index3_pseudo.sh

4、 index4-index10
index4-index10与index2、index3类似

5、汇总所有伪标签
5.1 在想要汇总伪标签的位置新建一个名称pseudo_label文件夹

5.2 进入每个增量数据集工程目录下的ouput/pseudo_label/并将里面的文件夹拷贝至自己的pseudo_label/文件夹下

```

# VOC->COCO运行命令
## 建议使用的验收方式
```
1、 放置VOC2007、VOC2012、COCO2017数据集

unbiased_teacher/
└── datasets/
    └──VOC2007/
    └──VOC2012/
    └── COCO2017/
        ├── train2017/
        ├── val2017/
        └── annotations/
        	├── instances_train2017.json
        	└── instances_val2017.json


2、VOC全监督训练
/bin/sh scripts/index1_sup.sh


3、VOC->COCO增量半监督训练
跑种子0
/bin/sh scripts/index1_semi_seed0.sh

跑种子5
/bin/sh scripts/index1_semi_seed5.sh

跑种子9
/bin/sh scripts/index1_semi_seed9.sh

```


# VOC2007train和VOC2012trainval全监督
## 建议使用的验收方式
```
1、 放置VOC2007、VOC2012、COCO2017数据集

unbiased_teacher/
└── datasets/
    └──VOC2007/
    └──VOC2012/
    └── COCO2017/
        ├── train2017/
        ├── val2017/
        └── annotations/
        	├── instances_train2017.json
        	└── instances_val2017.json


2、生成coco20类的训练集和验证集
python tools/index1/make_dataset_coco20.py


3、将coco20类数据集类别名与voc统一
python tools/index1/make_coco_name_modified.py


4、生成随机全监督种子
python generate_random_supervised_seed.py


5、使用模型进行全监督训练
python train_net.py \
	--num-gpus 4 \
	--config configs/index1/voc07train+voc12trainval_sup100_run1.yaml \
	OUTPUT_DIR output/index1/baseline/voc07train+voc12trainval_sup100


6、评估最好结果
python train_net.py \
	--eval-only \
	--num-gpus 4 \
	--config configs/index1/voc07train+voc12trainval_sup100_run1_val.yaml \
	MODEL.WEIGHTS output/index1/baseline/voc07train+voc12trainval_sup100/model_best.pth

```

# VOC20%+COCO主动样本挑选+19800无标签样本半监督
## 建议使用的验收方式
```
1、将全监督权重转化成半监督权重
python tools/index1/supervision_to_semi-supervision.py \
	--input-dir output/index1/baseline/voc07train+voc12trainval_sup100/model_best.pth
	--save-dir output/index1/baseline/voc07train+voc12trainval_sup100/one_stage.pth


2、随机抽取voc20%图片数据
python tools/index1/make_dataset_voc20%.py \
	--dataseed 0 \
	--save-dir datasets/index1/semi/voc20%/seed_0/


python tools/index1/make_dataset_voc20%.py \
	--dataseed 5 \
	--save-dir datasets/index1/semi/voc20%/seed_5/


python tools/index1/make_dataset_voc20%.py \
	--dataseed 9 \
	--save-dir datasets/index1/semi/voc20%/seed_9/


3、使用模型一阶段权重对coco20train进行样本挑选推理评分
python inference.py \
    --static-file temp/index1/coco20train.json \
    --model-weights output/index1/baseline/voc07train+voc12trainval_sup100/one_stage.pth\
    --config configs/index1/voc07train+voc12trainval_sup100_inference.yaml


python tools/index1/ScoreFunction.py \
	--static-file temp/index1/coco20train.json \
	--indicator-file results/coco20train
      
      
4、生成coco20有标签(主动样本挑选)和无标签对应的标注文件和图片
python tools/index1/make_dataset_target.py


python tools/index1/make_dataset_json2image.py


5、使用模型进行半监督训练(默认voc种子是0)
跑种子0
python train_net.py \
	--num-gpus 4 \
	--config configs/index1/voc07train+voc12trainval_semi_seed0.yaml \
	OUTPUT_DIR output/index1/semi/voc07train+voc12trainval_incremental \
	MODEL.WEIGHTS output/index1/baseline/voc07train+voc12trainval_sup100/one_stage.pth


跑种子5
python train_net.py \
	--num-gpus 4 \
	--config configs/index1/voc07train+voc12trainval_semi_seed5.yaml \
	OUTPUT_DIR output/index1/semi/voc07train+voc12trainval_incremental \
	MODEL.WEIGHTS output/index1/baseline/voc07train+voc12trainval_sup100/one_stage.pth


跑种子9
python train_net.py \
	--num-gpus 4 \
	--config configs/index1/voc07train+voc12trainval_semi_seed9.yaml \
	OUTPUT_DIR output/index1/semi/voc07train+voc12trainval_incremental \
	MODEL.WEIGHTS output/index1/baseline/voc07train+voc12trainval_sup100/one_stage.pth
	

6、评估最好结果
python train_net.py \
	--eval-only \
	--num-gpus 4 \
	--config configs/index1/voc07train+voc12trainval_semi_val.yaml \
	MODEL.WEIGHTS output/index1/semi/voc07train+voc12trainval_incremental/model_best.pth

```